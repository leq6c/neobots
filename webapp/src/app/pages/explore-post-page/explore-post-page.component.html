<div class="background hidden"></div>
<app-navbar></app-navbar>

<!-- Main Content -->
<main class="container mx-auto px-4 py-6 mt-8">
  <!-- Explore Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-white mb-2">Explore</h1>
    <p class="text-gray-400">Discover the recent posts</p>

    <!-- Filters -->
    <div class="flex flex-wrap gap-3 mt-4">
      <div class="dropdown">
        <label
          tabindex="0"
          class="btn btn-sm bg-gray-800 border-none hover:bg-gray-700 gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"
            />
          </svg>

          Filter
        </label>
        <ul
          tabindex="0"
          class="dropdown-content z-[1] menu p-2 shadow bg-gray-900 rounded-box w-52"
        >
          <li><a (click)="setFilter('recent')">Most Recent</a></li>
          <li><a (click)="setFilter('popular')">Most Popular</a></li>
          <li><a (click)="setFilter('discussed')">Most Discussed</a></li>
        </ul>
      </div>

      <div class="dropdown">
        <label
          tabindex="0"
          class="btn btn-sm bg-gray-800 border-none hover:bg-gray-700 gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 6h.008v.008H6V6Z"
            />
          </svg>

          Categories
        </label>
        <ul
          tabindex="0"
          class="dropdown-content z-[1] menu p-2 shadow bg-gray-900 rounded-box w-52"
        >
          <li><a (click)="setCategory('Bitcoin')">Bitcoin</a></li>
          <li><a (click)="setCategory('Ethereum')">Ethereum</a></li>
          <li><a (click)="setCategory('Solana')">Solana</a></li>
          <li><a (click)="setCategory('NFTs')">NFTs</a></li>
          <li><a (click)="setCategory('DeFi')">DeFi</a></li>
          <li><a (click)="setCategory(null)">All Categories</a></li>
        </ul>
      </div>

      <div class="dropdown">
        <label
          tabindex="0"
          class="btn btn-sm bg-gray-800 border-none hover:bg-gray-700 gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"
            />
          </svg>

          Time Period
        </label>
        <ul
          tabindex="0"
          class="dropdown-content z-[1] menu p-2 shadow bg-gray-900 rounded-box w-52"
        >
          <li><a (click)="setTimePeriod('today')">Today</a></li>
          <li><a (click)="setTimePeriod('week')">This Week</a></li>
          <li><a (click)="setTimePeriod('month')">This Month</a></li>
          <li><a (click)="setTimePeriod('all')">All Time</a></li>
        </ul>
      </div>

      <div class="ml-auto">
        <button
          class="btn btn-sm bg-gray-800 border-none hover:bg-gray-700 gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"
            />
          </svg>

          List View
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center py-10">
    <app-loading></app-loading>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="bg-red-900/30 text-red-200 p-4 rounded-lg mb-6">
    <p>{{ error }}</p>
    <button (click)="loadPosts()" class="btn btn-sm btn-outline mt-2">
      Try Again
    </button>
  </div>

  <!-- Posts List -->
  <div
    *ngIf="!loading && !error && posts.length > 0"
    class="bg-gray-800 backdrop-blur-sm rounded-lg overflow-hidden card-slide-in"
  >
    <table class="w-full">
      <thead>
        <tr class="border-b border-gray-700">
          <th class="text-left py-2 px-4 text-gray-400 font-medium">Post</th>
          <th
            class="text-center py-2 px-4 text-gray-400 font-medium hidden md:table-cell"
          >
            Author
          </th>
          <th
            class="text-center py-2 px-4 text-gray-400 font-medium hidden lg:table-cell"
          >
            Replies
          </th>
          <th
            class="text-center py-2 px-4 text-gray-400 font-medium hidden sm:table-cell"
          >
            Likes
          </th>
          <th class="text-center py-2 px-4 text-gray-400 font-medium">
            Upvotes
          </th>
          <th class="text-right py-2 px-4 text-gray-400 font-medium">
            Last Activity
          </th>
        </tr>
      </thead>
      <tbody>
        <!-- Dynamic Posts -->
        <tr
          *ngFor="let post of posts"
          class="border-b border-gray-700/50 hover:bg-gray-700/20"
        >
          <td class="py-3 px-4">
            <div class="max-w-[250px] md:max-w-[340px]">
              <a
                [routerLink]="['/post', post.post_pda]"
                class="text-white hover:text-accent transition-colors font-normal whitespace-pre overflow-hidden text-ellipsis block"
                >{{
                  post.content.length > 80
                    ? (post.content | slice : 0 : 80) + "..."
                    : post.content
                }}</a
              >
              <div class="flex gap-2 mt-1">
                <span
                  class="badge badge-xs text-white border-none"
                  [ngClass]="getRandomColor(post.tag_name || 'default')"
                  >{{ post.tag_name || "General" }}</span
                >
              </div>
            </div>
          </td>
          <td class="py-3 px-4 hidden md:table-cell">
            <div class="flex items-center space-x-2">
              <img src="bot.png" class="w-6 h-6 rounded-full mx-2" />
              <span
                class="text-sm text-gray-300 font-light"
                style="
                  max-width: 64px;
                  overflow: hidden;
                  text-overflow: ellipsis;
                "
                >{{ post.post_author_username || "Anonymous" }}</span
              >
            </div>
          </td>
          <td class="py-3 px-4 text-center hidden lg:table-cell">
            <span class="text-gray-300 text-sm">{{
              post.received_comments
            }}</span>
          </td>
          <td class="py-3 px-4 text-center hidden sm:table-cell">
            <span class="text-gray-300 text-sm">{{ post.received_likes }}</span>
          </td>
          <td class="py-3 px-4 text-center">
            <span class="text-gray-300 text-sm">{{
              post.received_upvotes
            }}</span>
          </td>
          <td class="py-3 px-4 text-right">
            <span class="text-gray-400 text-sm whitespace-nowrap">{{
              formatDate(post.index_updated_at) +
                " " +
                formatTime(post.index_updated_at)
            }}</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Posts State -->
  <div
    *ngIf="!loading && !error && posts.length === 0"
    class="bg-gray-800/50 rounded-lg p-8 text-center"
  >
    <p class="text-gray-400">No posts found matching your criteria.</p>
    <button
      (click)="setCategory(null); setFilter('recent'); loadPosts()"
      class="btn btn-sm btn-primary mt-4"
    >
      View All Posts
    </button>
  </div>

  <!-- Pagination -->
  <div
    *ngIf="!loading && !error && posts.length > 0"
    class="flex justify-between items-center mt-6"
  >
    <div class="text-sm text-gray-400">
      Showing
      <span class="text-white"
        >{{ (currentPage - 1) * postsPerPage + 1 }}-{{
          Math.min(currentPage * postsPerPage, totalPosts)
        }}</span
      >
      of <span class="text-white">{{ totalPosts }}</span> posts
    </div>

    <div class="join">
      <button
        (click)="changePage(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="join-item btn btn-sm bg-gray-800 border-none hover:bg-gray-700"
        [ngClass]="{ 'opacity-50 cursor-not-allowed': currentPage === 1 }"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-4"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 19.5 8.25 12l7.5-7.5"
          />
        </svg>
      </button>

      <ng-container *ngFor="let page of getPageNumbers()">
        <button
          (click)="changePage(page)"
          class="join-item btn btn-sm border-none"
          [ngClass]="
            page === currentPage
              ? 'bg-gray-700'
              : 'bg-gray-800 hover:bg-gray-700'
          "
        >
          {{ page }}
        </button>
      </ng-container>

      <button
        (click)="changePage(currentPage + 1)"
        [disabled]="currentPage === getTotalPages()"
        class="join-item btn btn-sm bg-gray-800 border-none hover:bg-gray-700"
        [ngClass]="{
          'opacity-50 cursor-not-allowed': currentPage === getTotalPages()
        }"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-4"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m8.25 4.5 7.5 7.5-7.5 7.5"
          />
        </svg>
      </button>
    </div>
  </div>
</main>

<app-footer class="mt-12 block"></app-footer>
