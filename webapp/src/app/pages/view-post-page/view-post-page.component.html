<div class="background"></div>
<app-navbar></app-navbar>

<!-- Loading State -->
<div
  *ngIf="loading"
  class="container mx-auto px-4 py-6 mt-8 flex justify-center"
>
  <div
    class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"
  ></div>
</div>

<!-- Error State -->
<div *ngIf="error" class="container mx-auto px-4 py-6 mt-8">
  <div class="bg-red-900/30 text-red-200 p-4 rounded-lg mb-6">
    <p>{{ error }}</p>
    <button (click)="fetch()" class="btn btn-sm btn-outline mt-2">
      Try Again
    </button>
  </div>
</div>

<!-- Main Content -->
<main
  *ngIf="!loading && !error && post"
  class="container mx-auto px-4 py-6 mt-8"
>
  <!-- Post Header -->
  <div class="mb-6">
    <div class="text-gray-500 text-xs mb-1">
      {{ post.post_pda }}
    </div>
    <h1 class="text-2xl font-medium text-white mb-1">
      {{
        post.content.length > 100
          ? (post.content | slice : 0 : 100) + "..."
          : post.content
      }}
    </h1>
    <div class="text-sm text-gray-500">
      {{ formatDate(post.index_created_at) }} by
      {{ post.post_author_username || "Anonymous" }}
    </div>

    <div class="flex gap-2 mt-4" *ngIf="post.tag_name">
      <span
        class="badge badge-sm"
        [ngClass]="
          post.tag_name === 'Bitcoin'
            ? 'bg-gray-700 text-white'
            : 'bg-gray-800 text-gray-400'
        "
        class="border-none"
      >
        {{ post.tag_name }}
      </span>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Posts Column -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Main Post Card -->
      <div class="flex justify-center">
        <div class="card bg-gray-900 backdrop-blur-sm shadow-xl max-w-[720px]">
          <div class="card-body">
            <div class="flex justify-between items-start">
              <div class="flex items-start space-x-4 w-full">
                <div class="avatar">
                  <div
                    class="w-16 h-16 rounded-full overflow-hidden"
                    [ngClass]="
                      getRandomColor(post.post_author_username || 'Anonymous')
                    "
                  >
                    <div
                      *ngIf="post.post_author_thumbnail"
                      class="flex items-center justify-center h-full text-white text-xl font-bold username"
                    >
                      {{
                        getInitials(post.post_author_username || "Anonymous")
                      }}
                    </div>
                    <img
                      *ngIf="post.post_author_thumbnail"
                      [src]="post.post_author_thumbnail"
                      [alt]="post.post_author_username + ' avatar'"
                      class="opacity-80"
                    />
                  </div>
                </div>
                <div class="grow-1">
                  <div class="flex flex-row justify-between">
                    <h3 class="text-lg font-medium username">
                      {{ post.post_author_username || "Anonymous" }}
                    </h3>
                    <div class="flex flex-col">
                      <div
                        class="badge badge-sm bg-gray-700 text-xs text-gray-300 border-none whitespace-nowrap"
                      >
                        {{ formatDate(post.index_created_at) }}
                      </div>
                      <div class="text-xs text-gray-500 mt-1 text-end h-0">
                        Official RPC
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4 text-gray-300">
              <p>{{ post.content }}</p>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-700">
              <div class="text-xs text-gray-500 mt-4 signature">
                {{ post.create_transaction_signature || post.post_pda }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Comments -->
      <div *ngFor="let comment of comments" class="flex justify-center">
        <div class="card bg-gray-900 backdrop-blur-sm shadow-xl max-w-[720px]">
          <div class="card-body">
            <div class="flex justify-between items-start">
              <div class="flex items-start space-x-4 w-full">
                <div class="avatar">
                  <div
                    class="w-16 h-16 rounded-full overflow-hidden"
                    [ngClass]="
                      getRandomColor(
                        comment.comment_author_username || 'Anonymous'
                      )
                    "
                  >
                    <div
                      class="flex items-center justify-center h-full text-white text-xl font-bold"
                    >
                      {{
                        getInitials(
                          comment.comment_author_username || "Anonymous"
                        )
                      }}
                    </div>
                  </div>
                </div>
                <div class="grow-1">
                  <div class="flex flex-row justify-between">
                    <h3 class="text-lg font-medium username">
                      {{ comment.comment_author_username || "Anonymous" }}
                    </h3>
                    <div class="flex flex-col">
                      <div
                        class="badge badge-sm bg-gray-700 text-xs text-gray-300 border-none whitespace-nowrap"
                      >
                        {{ formatDate(comment.index_created_at) }}
                      </div>
                      <div class="text-xs text-gray-500 mt-1 text-end h-0">
                        Official RPC
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4 text-gray-300">
              <p>{{ comment.content }}</p>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-700">
              <!-- Votes and Likes Section -->
              <div class="flex items-center space-x-4 mb-2">
                <div class="flex items-center space-x-1">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-4 h-4 text-green-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M4.5 15.75l7.5-7.5 7.5 7.5"
                    />
                  </svg>
                  <span class="text-xs text-gray-300">{{
                    comment.received_upvotes || 0
                  }}</span>
                </div>
                <div class="flex items-center space-x-1">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-4 h-4 text-red-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19.5 8.25l-7.5 7.5-7.5-7.5"
                    />
                  </svg>
                  <span class="text-xs text-gray-300">{{
                    comment.received_downvotes || 0
                  }}</span>
                </div>
                <div class="flex items-center space-x-1">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-4 h-4 text-pink-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"
                    />
                  </svg>
                  <span class="text-xs text-gray-300">{{
                    comment.received_likes || 0
                  }}</span>
                </div>
                <div class="flex items-center space-x-1 ml-auto">
                  <span class="text-xs text-gray-400">Karma:</span>
                  <span class="text-xs text-gray-300">{{
                    comment.karmas || 0
                  }}</span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-2 signature">
                {{ comment.create_transaction_signature }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Comments Message -->
      <div *ngIf="comments.length === 0" class="flex justify-center">
        <div class="card bg-gray-900 backdrop-blur-sm shadow-xl max-w-[720px]">
          <div class="card-body text-center text-gray-400">
            <p>No comments yet.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1 ml-4 hidden lg:block">
      <div class="card bg-gray-800 backdrop-blur-sm shadow-xl">
        <div class="card-body p-4">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-sm font-light opacity-60">Latest Posts</h3>
            <button
              class="btn btn-circle btn-xs bg-gray-700 border-none hover:bg-gray-600"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-3"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m19.5 8.25-7.5 7.5-7.5-7.5"
                />
              </svg>
            </button>
          </div>

          <!-- Latest Posts List -->
          <div class="space-y-4">
            <!-- Post 1 -->
            <div class="flex gap-3">
              <div>
                <div
                  class="w-6 h-6 rounded-md bg-teal-500 flex items-center justify-center text-white font-bold text-center mt-1"
                >
                  W
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-xs font-medium text-gray-300">
                  So building a pc for streaming and gaming
                </h4>
                <div class="text-[10px] text-gray-500 mt-1">
                  Why_Me • Yesterday at 7:05 PM
                </div>
                <div class="text-[10px] text-gray-500">Desktop Hardware</div>
              </div>
            </div>

            <div class="flex gap-3">
              <div>
                <div
                  class="w-6 h-6 rounded-md bg-teal-500 flex items-center justify-center text-white font-bold text-center mt-1"
                >
                  W
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-xs font-medium text-gray-300">
                  So building a pc for streaming and gaming
                </h4>
                <div class="text-[10px] text-gray-500 mt-1">
                  Why_Me • Yesterday at 7:05 PM
                </div>
                <div class="text-[10px] text-gray-500">Desktop Hardware</div>
              </div>
            </div>

            <div class="flex gap-3">
              <div>
                <div
                  class="w-6 h-6 rounded-md bg-teal-500 flex items-center justify-center text-white font-bold text-center mt-1"
                >
                  W
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-xs font-medium text-gray-300">
                  So building a pc for streaming and gaming
                </h4>
                <div class="text-[10px] text-gray-500 mt-1">
                  Why_Me • Yesterday at 7:05 PM
                </div>
                <div class="text-[10px] text-gray-500">Desktop Hardware</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Second Latest Posts Section -->
      <div class="card bg-gray-800 backdrop-blur-sm shadow-xl mt-4">
        <div class="card-body p-4">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-sm font-light opacity-60">Latest Posts</h3>
            <button
              class="btn btn-circle btn-xs bg-gray-700 border-none hover:bg-gray-600"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-3"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m19.5 8.25-7.5 7.5-7.5-7.5"
                />
              </svg>
            </button>
          </div>

          <!-- Latest Posts List -->
          <div class="space-y-4">
            <!-- Post 1 -->
            <div class="flex gap-3">
              <div>
                <div
                  class="w-6 h-6 rounded-md bg-teal-500 flex items-center justify-center text-white font-bold text-center mt-1"
                >
                  W
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-xs font-medium text-gray-300">
                  So building a pc for streaming and gaming
                </h4>
                <div class="text-[10px] text-gray-500 mt-1">
                  Why_Me • Yesterday at 7:05 PM
                </div>
                <div class="text-[10px] text-gray-500">Desktop Hardware</div>
              </div>
            </div>

            <div class="flex gap-3">
              <div>
                <div
                  class="w-6 h-6 rounded-md bg-teal-500 flex items-center justify-center text-white font-bold text-center mt-1"
                >
                  W
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-xs font-medium text-gray-300">
                  So building a pc for streaming and gaming
                </h4>
                <div class="text-[10px] text-gray-500 mt-1">
                  Why_Me • Yesterday at 7:05 PM
                </div>
                <div class="text-[10px] text-gray-500">Desktop Hardware</div>
              </div>
            </div>

            <div class="flex gap-3">
              <div>
                <div
                  class="w-6 h-6 rounded-md bg-teal-500 flex items-center justify-center text-white font-bold text-center mt-1"
                >
                  W
                </div>
              </div>
              <div class="flex-1">
                <h4 class="text-xs font-medium text-gray-300">
                  So building a pc for streaming and gaming
                </h4>
                <div class="text-[10px] text-gray-500 mt-1">
                  Why_Me • Yesterday at 7:05 PM
                </div>
                <div class="text-[10px] text-gray-500">Desktop Hardware</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<app-footer></app-footer>
